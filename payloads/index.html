
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <link rel="canonical" href="http://redisearch.io/payloads/">
      
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.1, mkdocs-material-1.1.1">
    
    
      
        <title>Document Payloads - RediSearch Documentation</title>
      
    
    
      <script src="../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-4ebe3f1d68.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-f6789307ff.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="indigo" data-md-color-accent="">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href=".." title="RediSearch Documentation" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
            
            Document Payloads
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/RedisLabsModules/RediSearch" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." title="RediSearch" class="md-tabs__link md-tabs__link--active">
        RediSearch
      </a>
    
  </li>

      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    RediSearch Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/RedisLabsModules/RediSearch" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="RediSearch" class="md-nav__link">
      RediSearch
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Quick_Start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Clients/" title="Client Libraris" class="md-nav__link">
      Client Libraris
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Commands/" title="Commands" class="md-nav__link">
      Commands
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Query_Syntax/" title="Query Syntax" class="md-nav__link">
      Query Syntax
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Sorting/" title="Sortable Values" class="md-nav__link">
      Sortable Values
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Extensions/" title="Extension API" class="md-nav__link">
      Extension API
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Stemming/" title="Stemming Support" class="md-nav__link">
      Stemming Support
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../python_client/" title="Python API" class="md-nav__link">
      Python API
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../java_client/" title="Java API" class="md-nav__link">
      Java API
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Document Payloads
      </label>
    
    <a href="./" title="Document Payloads" class="md-nav__link md-nav__link--active">
      Document Payloads
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#adding-payloads-for-documents" title="Adding payloads for documents:" class="md-nav__link">
    Adding payloads for documents:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluating-payloads-in-query-time" title="Evaluating Payloads in Query Time" class="md-nav__link">
    Evaluating Payloads in Query Time
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieving-payloads-from-documents" title="Retrieving payloads from documents" class="md-nav__link">
    Retrieving payloads from documents
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#adding-payloads-for-documents" title="Adding payloads for documents:" class="md-nav__link">
    Adding payloads for documents:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluating-payloads-in-query-time" title="Evaluating Payloads in Query Time" class="md-nav__link">
    Evaluating Payloads in Query Time
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieving-payloads-from-documents" title="Retrieving payloads from documents" class="md-nav__link">
    Retrieving payloads from documents
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
                 <a href="https://github.com/RedisLabsModules/RediSearch/edit/master/docs/payloads.md" title="Edit this page" class="md-icon md-content__edit">edit</a>
               
              
                
                <h1 id="document-payloads">Document Payloads<a class="headerlink" href="#document-payloads" title="Permanent link">&para;</a></h1>
<p>Usually, redisearch stores documents as HASH keys. But if you want to access some data for 
aggregation or scoring functions, we might want to store that data as an inline payload. 
This will allow us to evaluate properties of a document for scoring purposes at very low cost.</p>
<p>Since the scoring functions already have access to the DocumentMetaData, which contains document flags and score,
We can add custom payloads that can be evaluated in run-time.</p>
<p>Payloads are NOT indexed and are not treated by the engine in any way. They are simply there for the purpose 
of evaluating them in query time, and optionally retrieving them. They can be JSON objects, strings, or preferably, 
if you are interested in fast evaluation, some sort of binary encoded data which is fast to decode.</p>
<h2 id="adding-payloads-for-documents">Adding payloads for documents:<a class="headerlink" href="#adding-payloads-for-documents" title="Permanent link">&para;</a></h2>
<p>When inserting a document using FT.ADD, you can ask RediSearch to store an arbitrary binary safe string as the document payload.
This is done with the PAYLOAD keyword:</p>
<div class="codehilite"><pre><span></span>FT.ADD {index_name} {doc_id} {score} PAYLOAD {payload} FIELDS {field} {data}...
</pre></div>


<h2 id="evaluating-payloads-in-query-time">Evaluating Payloads in Query Time<a class="headerlink" href="#evaluating-payloads-in-query-time" title="Permanent link">&para;</a></h2>
<p>When imlplementing a scoring function, the signature of the function exposed is:</p>
<div class="codehilite"><pre><span></span><span class="kt">double</span> <span class="p">(</span><span class="o">*</span><span class="n">ScoringFunction</span><span class="p">)(</span><span class="n">DocumentMetadata</span> <span class="o">*</span><span class="n">dmd</span><span class="p">,</span> <span class="n">IndexResult</span> <span class="o">*</span><span class="n">h</span><span class="p">);</span>
</pre></div>


<blockquote>
<p>NOTE: currently scoring functions cannot be dynamically added, and forking the engine and replacing them is required.</p>
</blockquote>
<p>DocumentMetaData includes a few fields, one of them being the payload. It wraps a simple byte array with
arbitrary length:</p>
<div class="codehilite"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span>  <span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
    <span class="kt">uint32_t</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span> <span class="n">DocumentPayload</span><span class="p">;</span>
</pre></div>


<p>If no payload was set to the document, it is simply NULL. If it is not, you can go ahead and decode it.
It is recommended to encode some metadata about the payload inside it, like a leading version number, etc.</p>
<h2 id="retrieving-payloads-from-documents">Retrieving payloads from documents<a class="headerlink" href="#retrieving-payloads-from-documents" title="Permanent link">&para;</a></h2>
<p>When searching, it is possible to request the document payloads from the engine. </p>
<p>This is done by adding the keyword <code>WITHPAYLOADS</code> to <code>FT.SEARCH</code>. </p>
<p>If <code>WITHPAYLOADS</code> is set, the payloads follow the document id in the returned result. 
If <code>WITHSCORES</code> is set as well, the payloads follow the scores. e.g.:</p>
<div class="codehilite"><pre><span></span>127.0.0.1:6379&gt; FT.CREATE foo SCHEMA bar TEXT
OK
127.0.0.1:6379&gt; FT.ADD foo doc2 1.0 PAYLOAD &quot;hi there!&quot; FIELDS bar &quot;hello&quot;
OK
127.0.0.1:6379&gt; FT.SEARCH foo &quot;hello&quot; WITHPAYLOADS WITHSCORES
1) (integer) 1
2) &quot;doc2&quot;           # id
3) &quot;1&quot;              # score
4) &quot;hi there!&quot;      # payload
5) 1) &quot;bar&quot;         # fields
   2) &quot;hello&quot;
</pre></div>
              
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../java_client/" title="Java API" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Java API
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-30ac6a1727.js"></script>
      <script>app.initialize({url:{base:".."}})</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-89573912-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>