<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Document Payloads - RediSearch Documentation</title>
      
      
      
        <link rel="canonical" href="http://redisearch.io/payloads/">
      
      
    
    <meta property="og:url" content="http://redisearch.io/payloads/">
    <meta property="og:title" content="RediSearch Documentation">
    <meta property="og:image" content="http://redisearch.io/payloads//../">
    <meta name="apple-mobile-web-app-title" content="RediSearch Documentation">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../assets/images/favicon-e565ddfa3b.ico">
    <link rel="icon" type="image/x-icon" href="../assets/images/favicon-e565ddfa3b.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../assets/fonts/icon.eot?52m981');
      	src: url('../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../assets/stylesheets/application-a422ff04cc.css">
    
    
      
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
      <style>
        body, input {
          font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
    <script src="../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class=" ">
    
      
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Reference <i class="icon icon-link"></i>
              
            
          </span>
        
        Document Payloads
      </div>
    </div>
    
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/RedisLabsModules/RediSearch" class="project">
    <div class="banner">
      
      <div class="name">
        <strong>
          RediSearch Documentation
          <span class="version">
            
          </span>
        </strong>
        
          <br>
          RedisLabsModules/RediSearch
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/RedisLabsModules/RediSearch/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/RedisLabsModules/RediSearch/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Home" href="..">
      Home
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Quick Start" href="../Quick_Start/">
      Quick Start
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Commands" href="../Commands/">
      Commands
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Reference</span>
    <ul>
      
        
  <li>
    <a class="" title="Query Syntax" href="../Query_Syntax/">
      Query Syntax
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Stemming Support" href="../Stemming/">
      Stemming Support
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Python API" href="../python_client/">
      Python API
    </a>
    
  </li>

      
        
  <li>
    <a class="current" title="Document Payloads" href="./">
      Document Payloads
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Adding payloads for documents:" href="#adding-payloads-for-documents">
                Adding payloads for documents:
              </a>
            </li>
          
            <li class="anchor">
              <a title="Evaluating Payloads in Query Time" href="#evaluating-payloads-in-query-time">
                Evaluating Payloads in Query Time
              </a>
            </li>
          
            <li class="anchor">
              <a title="Retrieving payloads from documents" href="#retrieving-payloads-from-documents">
                Retrieving payloads from documents
              </a>
            </li>
          
        </ul>
      
    
  </li>

      
    </ul>
  </li>

          
        </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <h1 id="document-payloads">Document Payloads</h1>
<p>Usually, redisearch stores documents as HASH keys. But if you want to access some data for 
aggregation or scoring functions, we might want to store that data as an inline payload. 
This will allow us to evaluate properties of a document for scoring purposes at very low cost.</p>
<p>Since the scoring functions already have access to the DocumentMetaData, which contains document flags and score,
We can add custom payloads that can be evaluated in run-time.</p>
<p>Payloads are NOT indexed and are not treated by the engine in any way. They are simply there for the purpose 
of evaluating them in query time, and optionally retrieving them. They can be JSON objects, strings, or preferably, 
if you are interested in fast evaluation, some sort of binary encoded data which is fast to decode.</p>
<h2 id="adding-payloads-for-documents">Adding payloads for documents:</h2>
<p>When inserting a document using FT.ADD, you can ask RediSearch to store an arbitrary binary safe string as the document payload.
This is done with the PAYLOAD keyword:</p>
<pre><code>FT.ADD {index_name} {doc_id} {score} PAYLOAD {payload} FIELDS {field} {data}...
</code></pre>

<h2 id="evaluating-payloads-in-query-time">Evaluating Payloads in Query Time</h2>
<p>When imlplementing a scoring function, the signature of the function exposed is:</p>
<pre><code class="c">double (*ScoringFunction)(DocumentMetadata *dmd, IndexResult *h);
</code></pre>

<blockquote>
<p>NOTE: currently scoring functions cannot be dynamically added, and forking the engine and replacing them is required.</p>
</blockquote>
<p>DocumentMetaData includes a few fields, one of them being the payload. It wraps a simple byte array with
arbitrary length:</p>
<pre><code class="c">typedef struct  {
    char *data,
    uint32_t len;
} DocumentPayload;
</code></pre>

<p>If no payload was set to the document, it is simply NULL. If it is not, you can go ahead and decode it.
It is recommended to encode some metadata about the payload inside it, like a leading version number, etc.</p>
<h2 id="retrieving-payloads-from-documents">Retrieving payloads from documents</h2>
<p>When searching, it is possible to request the document payloads from the engine. </p>
<p>This is done by adding the keyword <code>WITHPAYLOADS</code> to <code>FT.SEARCH</code>. </p>
<p>If <code>WITHPAYLOADS</code> is set, the payloads follow the document id in the returned result. 
If <code>WITHSCORES</code> is set as well, the payloads follow the scores. e.g.:</p>
<pre><code>127.0.0.1:6379&gt; FT.CREATE foo SCHEMA bar TEXT
OK
127.0.0.1:6379&gt; FT.ADD foo doc2 1.0 PAYLOAD &quot;hi there!&quot; FIELDS bar &quot;hello&quot;
OK
127.0.0.1:6379&gt; FT.SEARCH foo &quot;hello&quot; WITHPAYLOADS WITHSCORES
1) (integer) 1
2) &quot;doc2&quot;           # id
3) &quot;1&quot;              # score
4) &quot;hi there!&quot;      # payload
5) 1) &quot;bar&quot;         # fields
   2) &quot;hello&quot;
</code></pre>
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../python_client/" title="Python API">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Python API
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '..';
      var repo_id  = 'RedisLabsModules/RediSearch';
    </script>
    <script src="../assets/javascripts/application-997097ee0c.js"></script>
    
    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', 'https://www.google-analytics.com/analytics.js', 'ga');
        /* General initialization */
        ga('create', 'UA-89573912-1', 'redisearch');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
        /* Track outbound links */
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
        /* Register handler to log search on blur */
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    
  </body>
</html>